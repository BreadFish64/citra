language: cpp
matrix:
  include:
  - os: linux
    env: NAME="clang-format"
    sudo: required
    dist: trusty
    services: docker
    install: "./.travis/clang-format/deps.sh"
    script: "./.travis/clang-format/build.sh"
  - os: linux
    env: NAME="linux build"
    sudo: required
    dist: trusty
    services: docker
    addons:
      apt:
        packages:
        - p7zip-full
    install: "./.travis/linux/deps.sh"
    script: "./.travis/linux/build.sh"
    after_success: "./.travis/linux/upload.sh"
    cache: ccache
  - if: repo = citra-emu/citra AND branch = master AND type = push
    os: linux
    env: NAME="transifex push"
    sudo: required
    dist: trusty
    services: docker
    install: "./.travis/transifex/deps.sh"
    script: "./.travis/transifex/build.sh"
  - os: osx
    env: NAME="macos build"
    sudo: false
    osx_image: xcode10
    install: "./.travis/macos/deps.sh"
    script: "./.travis/macos/build.sh"
    after_success: "./.travis/macos/upload.sh"
    cache: ccache
  - os: linux
    env: NAME="linux build (frozen versions of dependencies)"
    sudo: required
    dist: trusty
    services: docker
    cache: ccache
    script: "./.travis/linux-frozen/build.sh"
  - os: linux
    env: NAME="MinGW build"
    sudo: required
    dist: trusty
    services: docker
    addons:
      apt:
        packages:
        - p7zip-full
    install: "./.travis/linux-mingw/deps.sh"
    script: "./.travis/linux-mingw/build.sh"
    after_success: "./.travis/linux-mingw/upload.sh"
    cache: ccache
  - if: repo =~ ^.*\/(citra-canary|citra-nightly)$ AND tag IS present
    git:
      depth: false
    os: linux
    env: NAME="flatpak build"
    sudo: required
    dist: trusty
    services: docker
    cache: ccache
    install: "./.travis/linux-flatpak/deps.sh"
    script: "./.travis/linux-flatpak/build.sh"
    after_script: "./.travis/linux-flatpak/finish.sh"
deploy:
  provider: releases
  api_key:
    secure: nmYg2A5zfUrYR24+NAyofMiQWJhQRxoOzt7X7+fcOiwDfQ10kb4q7VS3qxyx6yUIbAdUCHLacdiu86BdRWRX3mMhImazJtv2hd0+6q6cwBeOk3MFhwzZGgcHjgfzFEaxQ/+mcWuUbxutDSghJZstsCJSvQyjKED+fVhf6Mpn0BCTSjlcTbGntYzaOLV+Kt1ToxAUrfsS1/rdNdYj6TmDbzrEBAkRBA2jf2KqEX+Qp9cfGMDER/2oz3rLtxxBa9o9G6XOaTs7Dj6JxnwGzJEweFAUlJZ28oiaug3OTVBSVTrM9dq+/GkxsQzGEOxFwowaTJQAiewRqMeEOcT6HZN66ODZ+D/Fc8g9fgJqELAwNGgPA3kKnpRJyKHeCeE9oyCRc0olXY26shuDtk3tvJ4bsmxQwECZUKxmTi8MNZHrqZ8HIR7FlfWRr4ahaNa/zHZXjkPx6JIuCbvyGzFz0u/5nKpqQq5TH0+WCyp48Q8AwDWbsvQbJGjcKyqtkbTXpenxqnKvAH4718rvN09KGDOPF0zGHuX1W8VFtikTh4G/vdVcRNt5gqxcPyFiXhCMjzSlGKa8rO77KLranJKucoC3Fn6tzHxNJEgrOprA7GZtqWU41DkTKPx3pFE4saMKvv0/sQjJ/iaR9QdIGVh2fkd0sFlnGghE7crh9ATRDnneI8g=
  skip_cleanup: true
  file: "artifacts/*"
  file_glob: true
  on:
    repo: BreadFish64/citra
    all_branches: true
notifications:
  webhooks:
    urls:
    - https://api.citra-emu.org/code/travis/notify
    